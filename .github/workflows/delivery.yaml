name: delivery
on:
  push:
    branches:
    - 'dotnet'
jobs:
  deploy:
    name: deploy
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 3.1.101
      - run: sudo apt-get update
      - run: sudo apt-get install --yes ca-certificates curl apt-transport-https lsb-release gnupg
      - run: curl -sL https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor | sudo tee /etc/apt/trusted.gpg.d/microsoft.asc.gpg > /dev/null
      - run: echo "deb [arch=amd64] https://packages.microsoft.com/repos/azure-cli/ $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/azure-cli.list
      - run: echo "deb [arch=amd64] https://packages.microsoft.com/repos/azurecore/ $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/azurecore.list
      - run: sudo apt-get update
      - run: sudo apt-get install --yes azure-cli azure-functions-core-tools
      - run: az login --service-principal -u "${{ secrets.APP_ID }}" -p "${{ secrets.PASSWORD }}" --tenant "${{ secrets.TENANT }}"
      - name: publish
        run: func azure functionapp publish syncify
        working-directory: sources/Syncify
